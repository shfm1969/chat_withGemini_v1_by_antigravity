<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>與 AI 聊天 - Gemini 2.0 Flash</title>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top left, #1a1a2e, #16213e, #0f3460);
            min-height: 100vh;
            color: #e9ecef;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }

        .chat-container {
            height: calc(100vh - 200px);
        }

        .message-bubble {
            max-width: 80%;
            transition: all 0.2s ease;
        }

        .user-message {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            background: rgba(255, 255, 255, 0.1);
            color: #f8fafc;
            border-bottom-left-radius: 4px;
        }

        .loading-dots div {
            width: 8px;
            height: 8px;
            background-color: #94a3b8;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dots .dot1 {
            animation-delay: -0.32s;
        }

        .loading-dots .dot2 {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1.0);
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div id="app" class="max-w-4xl mx-auto flex flex-col h-full space-y-6">
        <!-- Header -->
        <header class="flex items-center justify-between px-6 py-4 glass-panel shadow-2xl">
            <div class="flex items-center space-x-3">
                <div
                    class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <h1 class="text-2xl font-bold tracking-tight text-white font-['Outfit']">與 AI 聊天</h1>
            </div>
            <div class="flex items-center space-x-2">
                <span class="flex h-3 w-3 relative">
                    <span
                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                </span>
                <span class="text-sm font-medium text-emerald-400">{{ availableModels.find(m => m.value ===
                    selectedModel)?.label || selectedModel }}</span>
            </div>
        </header>

        <!-- Chat Area -->
        <main class="flex-grow glass-panel chat-container overflow-hidden flex flex-col shadow-2xl">
            <div ref="chatBox" class="flex-grow overflow-y-auto p-6 space-y-6 scroll-smooth">
                <!-- Welcome Message -->
                <div v-if="messages.length === 0"
                    class="flex flex-col items-center justify-center h-full text-center space-y-4 opacity-70">
                    <div class="w-20 h-20 rounded-2xl bg-white/5 flex items-center justify-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-400" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold">準備好激發一些想法了嗎？</h2>
                    <p class="max-w-xs text-sm">與您的 AI 創意夥伴 Gemini 開始對話。</p>
                </div>

                <!-- Messages -->
                <div v-for="(msg, index) in messages" :key="index"
                    :class="msg.role === 'user' ? 'flex justify-end' : 'flex justify-start'"
                    class="animate-in fade-in slide-in-from-bottom-2 duration-300">
                    <div :class="msg.role === 'user' ? 'user-message' : 'ai-message'"
                        class="message-bubble px-5 py-3 rounded-2xl shadow-lg leading-relaxed text-sm md:text-base whitespace-pre-wrap">
                        {{ msg.content }}
                    </div>
                </div>

                <!-- Loading Indicator -->
                <div v-if="isLoading" class="flex justify-start animate-pulse">
                    <div class="ai-message message-bubble px-5 py-3 rounded-2xl shadow-lg flex items-center space-x-2">
                        <div class="loading-dots">
                            <div class="dot1"></div>
                            <div class="dot2"></div>
                            <div class="dot3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t border-white/10 bg-white/5">
                <form @submit.prevent="sendMessage" class="flex flex-col gap-4">
                    <div class="flex gap-3">
                        <input v-model="userInput" type="text" placeholder="請在此輸入您的訊息..."
                            class="flex-grow bg-white/10 border border-white/10 rounded-xl px-5 py-3 text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                            :disabled="isLoading">
                        <select v-model="selectedModel" :disabled="isLoading"
                            class="bg-white/10 border border-white/10 rounded-xl px-3 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-sm appearance-none cursor-pointer hover:bg-white/20">
                            <option v-for="model in availableModels" :key="model.value" :value="model.value"
                                class="bg-[#16213e]">
                                {{ model.label }}
                            </option>
                        </select>
                        <button type="submit" :disabled="isLoading || !userInput.trim()"
                            class="bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white p-3 rounded-xl transition-all shadow-lg hover:shadow-indigo-500/20 active:scale-95 flex items-center justify-center min-w-[3rem]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                    <!-- API Key Input -->
                    <div class="relative group">
                        <input v-model="apiKeyInput" type="password" placeholder="請輸入您的 Gemini API Key..."
                            class="w-full bg-white/5 border border-white/5 rounded-xl px-4 py-2 text-xs text-white/60 placeholder-white/20 focus:outline-none focus:ring-1 focus:ring-indigo-500/50 transition-all focus:bg-white/10"
                            :disabled="isLoading">
                        <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none opacity-20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.4 w-3.4" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                            </svg>
                        </div>
                    </div>
                </form>
            </div>
        </main>

        <footer class="text-center text-xs text-white/40 font-medium">
            由 Gemini 2.0 Flash 驅動 • 使用 Vue 3 和 Tailwind CSS 構建
        </footer>
    </div>

    <script>
        const { createApp, ref, nextTick } = Vue;

        createApp({
            setup() {
                // --- CONFIGURATION ---
                const DEFAULT_API_KEY = ''; // 預設留空，由使用者輸入
                const apiKeyInput = ref(DEFAULT_API_KEY);

                const availableModels = [
                    { label: 'Gemini 3 Flash (Preview)', value: 'gemini-3-flash-preview' },
                    { label: 'Gemini 2.5 Flash', value: 'gemini-2.5-flash' },
                    { label: 'Gemini 2.5 Pro', value: 'gemini-2.5-pro' },
                ];

                const selectedModel = ref('gemini-3-flash-preview');

                const getApiUrl = (model, key) => `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;

                const userInput = ref('');
                const isLoading = ref(false);
                const messages = ref([]);
                const chatBox = ref(null);

                const scrollToBottom = async () => {
                    await nextTick();
                    if (chatBox.value) {
                        chatBox.value.scrollTop = chatBox.value.scrollHeight;
                    }
                };

                const sendMessage = async () => {
                    if (!userInput.value.trim() || isLoading.value) return;

                    if (!apiKeyInput.value.trim()) {
                        messages.value.push({
                            role: 'assistant',
                            content: '請先在下方輸入您的 Gemini API Key 才能開始聊天。'
                        });
                        await scrollToBottom();
                        return;
                    }

                    const userMessage = userInput.value.trim();
                    messages.value.push({ role: 'user', content: userMessage });
                    userInput.value = '';
                    isLoading.value = true;
                    await scrollToBottom();

                    try {
                        const response = await fetch(getApiUrl(selectedModel.value, apiKeyInput.value), {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [
                                    {
                                        parts: [{ text: userMessage }]
                                    }
                                ],
                                generationConfig: {
                                    temperature: 0.7,
                                    maxOutputTokens: 2048,
                                }
                            })
                        });

                        const data = await response.json();

                        if (data.error) {
                            throw new Error(data.error.message || 'API Error');
                        }

                        const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || '我無法取得回應。';
                        messages.value.push({ role: 'assistant', content: aiResponse });
                    } catch (error) {
                        console.error('Error:', error);
                        messages.value.push({
                            role: 'assistant',
                            content: `發生錯誤：${error.message}。請確認您的 API 金鑰是否正確。`
                        });
                    } finally {
                        isLoading.value = false;
                        await scrollToBottom();
                    }
                };

                return {
                    userInput,
                    isLoading,
                    messages,
                    sendMessage,
                    chatBox,
                    selectedModel,
                    availableModels,
                    apiKeyInput
                };
            }
        }).mount('#app');
    </script>
</body>

</html>